---
name: iiwarmup 상용화 — 로그인 필수 + 콘텐츠 장단점
overview: 비로그인 구독자 제거 후 로그인 필수 재생으로 전환하고, 검증된 아이디(우리쪽 제공)와 연동한다. 콘텐츠 관점 장단점을 정리하며, 보완되지 않은 명확한 단점은 상용화 불가로 본다.
todos:
  - id: auth-page
    content: "/iiwarmup 페이지 — 미로그인 시 로그인 유도/리다이렉트, 로그인 후에만 재생 가능"
    status: pending
  - id: auth-api
    content: "/api/schedule/[weekKey] — 세션/토큰 검증 후 검증된 아이디 allowlist 체크(구조 연동)"
    status: pending
  - id: content-doc
    content: "콘텐츠 장단점 문서화 및 단점 보완 항목 정리"
    status: pending
isProject: false
---

# iiwarmup 상용화 — 로그인 필수 전환 + 콘텐츠 관점 정리

## Part 1. 비로그인 구독자 제거 → 로그인 필수 재생

### 1.1 방향

- **현재**: `/api/schedule/[weekKey]`는 service_role로 RLS 없이 조회 → 링크만 있으면 비로그인으로 재생 가능.
- **변경**: 재생은 **로그인 필수**. 로그인한 사용자 중 **검증된 아이디**만 재생 허용(우리쪽에서 검증된 ID 구조 제공 예정).

### 1.2 앱 측에서 할 일

- **구독자 페이지 [`app/iiwarmup/page.tsx`](app/iiwarmup/page.tsx)**
  - 진입 시 세션 확인. **미로그인**이면 로그인 유도(로그인 페이지 리다이렉트 또는 로그인 UI 노출).
  - 로그인 후에만 "전체 재생 / Play만 / Think만 / Flow만" 등 재생 CTA 활성화 및 `FullSequencePlayer` 진입 허용.

- **스케줄 API [`app/api/schedule/[weekKey]/route.ts`](app/api/schedule/[weekKey]/route.ts)**
  - 요청에 **인증 정보**(Supabase 세션 쿠키 또는 Authorization 헤더) 포함해 호출하도록 클라이언트 수정.
  - API 내부: 세션/토큰으로 **현재 사용자 식별**. 식별 실패 시 401.
  - 식별된 사용자 ID가 **검증된 아이디 목록**에 있는지 확인. 목록은 "우리쪽에서 준비하는 구조"(DB 테이블, 외부 API, 환경변수 등)와 연동.
  - 검증 통과 시에만 기존처럼 `rotation_schedule` + `warmup_programs_composite` + Think/BGM 데이터 반환. 검증 실패 시 403 또는 "구독 권한 없음" 응답.

- **검증된 아이디 구조(우리쪽 준비)**
  - 예: `iiwarmup_allowed_users` 테이블(user_id), 또는 허용 목록을 반환하는 API. 앱은 "현재 user_id가 이 목록에 있는가?"만 검사하면 됨.

### 1.3 정리

| 구분 | 내용 |
|------|------|
| 페이지 | `/iiwarmup` — 미로그인 시 로그인 필수, 로그인 후에만 재생 가능하도록 변경 |
| API | `/api/schedule/[weekKey]` — 인증 필수, 검증된 user_id만 200 + 프로그램 데이터 반환 |
| 검증 목록 | 우리쪽에서 제공할 구조(테이블/API 등)와 연동해 allowlist 체크 |

---

## Part 2. 콘텐츠 관점 — 장단점 및 상용화 관점

### 2.1 콘텐츠 구성 요약

- **형식**: 약 10분 복합 웜업. Play(약 2분) → Think(약 2분) → Flow(약 5분)를 한 번의 START로 연속 재생.
- **Play**: 몰입형 게임형 웜업. 15개 액션 이미지(테마별, 예: 주방), 리듬 챌린지(SpokeduRhythmGame) 가능. BPM/레벨/그리드는 주차별 편성.
- **Think**: 인지 훈련. Think150 기반, 월·주차별 이미지 팩, cue/blank 타이밍은 audience(900ms/700ms/550ms)로 조절. BGM 별도.
- **Flow**: 유동성 웜업. 3D 러닝/점프, BGM·파노라마, 레벨 구간·엔딩까지 자동 진행.
- **제공 방식**: 주차별 1개 프로그램 자동 노출(이번 주), 관리자 Scheduler에서 배정·발행.

### 2.2 장점 (콘텐츠)

- **구조화된 10분**: 한 번에 몰입(Play) → 인지(Think) → 신체 유동성(Flow)으로 이어져, 수업/활동 전 웜업으로 쓰기 좋음.
- **주차별 갱신**: 매주 다른 프로그램으로 지속 참여 유도, 반복 피로 완화.
- **관리자 통제**: 편성·발행 권한이 있어 품질·일정을 한 곳에서 관리 가능.
- **연령/난이도 파라미터**: Think의 audience(900/700/550ms)로 난이도 조절 가능(다만 현재는 스케줄러에서 선택 UI·스냅샷 반영이 제한적).
- **재생 옵션**: 전체/Play만/Think만/Flow만 선택으로 단계별 활용 가능.

### 2.3 단점 (콘텐츠) — 보완 전 상용화 불가로 볼 수 있는 것

- **편성 의존도**
  - **문제**: 주차별 콘텐츠가 전적으로 관리자 편성에 의존. 해당 주차에 배정·발행이 없으면 "이번 주 프로그램 없음"만 보임.
  - **상용화 관점**: 빈 주차가 반복되면 서비스 신뢰도 하락. **보완**: 최소한 "기본 폴백 프로그램" 또는 자동 재사용 규칙으로 빈 주차가 없도록 보장.

- **연령/난이도 일관성**
  - **문제**: Think의 audience는 3단계 있으나, 문서상 Scheduler에서 `audience: 'elementary'` 하드코딩 등으로 실제 반영이 제한적. Play/Flow는 연령대별 난이도가 명시적으로 드러나지 않음.
  - **상용화 관점**: 연령대가 다른 사용자에게 동일 콘텐츠만 제공 시 이탈 가능. **보완**: 스케줄러에서 audience/난이도 선택 후 program_snapshot에 저장하고, 구독자에게 일관되게 적용.

- **콘텐츠량·다양성**
  - **문제**: 테마·이미지·BGM은 에셋 제작량에 좌우. 에셋이 적으면 주차가 바뀌어도 체감 다양성이 낮을 수 있음.
  - **상용화 관점**: 장기 이용 시 단조로움. **보완**: 에셋 로드맵·월별/분기별 신규 테마 도입, 또는 재생 로그 기반으로 자주 쓰는 구간 강화.

- **접근성·다국어**
  - **문제**: 현재 문구·UI가 한국어 중심, 접근성(자막, 스크린리더, 조작 간소화)은 문서상 별도 정리 부족.
  - **상용화 관점**: 교육·기관 입찰 시 접근성·다국어 요구 시 불리. **보완**: 최소한 핵심 문구·안내 다국어화, 자막/대체 텍스트 정책 수립.

### 2.4 요약 — 콘텐츠와 상용화

- **장점**: 구조화된 10분, 3단계 설계, 주차별 갱신, 관리자 통제, 연령 파라미터(Think) 존재.
- **명확한 단점(보완 전 상용화 불가)**:
  1. **빈 주차/미발행** → 폴백 또는 자동 편성으로 "빈 주차 없음" 보장 필요.
  2. **연령/난이도 미조정** → 스케줄러에서 audience/난이도 선택 후 스냅샷 반영해 전 단계에 일관 적용 필요.
- 그 외(다양성, 접근성·다국어)는 서비스 타깃과 일정에 따라 단계적 보완으로 진행 가능.

---

## Part 3. 몰입을 위한 콘텐츠 보완 — 구체적 수정 포인트

> UI/UX·구조만으로는 몰입 상한이 낮다. **콘텐츠(문구·서사·피드백)**를 보완해 "한 편의 10분"으로 느껴지게 하는 항목이다. 코드 상 실제 노출 위치와 연동해 작성했다.

### 3.1 서사·목표감 — "오늘의 10분"이 한 편으로 느껴지게

**현상**: 랜딩에는 "미션으로 몰입하도록 설계했어요"라고 되어 있으나, 재생 시작 후 **한 번의 이야기나 미션**이 이어지지 않음. Think → Play → Flow가 각각 따로 노는 느낌.

**수정 포인트**:

- **전체 재생 클릭 직후, Think 진입 전**: 3~5초짜리 **오프닝 한 장** 노출(또는 Think intro 5초와 통합).
  - 예시 문구: *"오늘의 미션: 띵크로 두뇌 깨우기 → 챌린지로 리듬 타기 → 플로우로 몸 풀기. 10분 뒤면 준비 완료예요."*
  - 구현: FullSequencePlayer에서 `mode === 'full'`이고 첫 phase 진입 직전에 한 번만 표시. 문구는 상수 또는 스케줄/주차 메타에서 가져와 주차별로 바꿀 수 있으면 더 좋음.
- **목표**: 사용자가 "지금부터 10분은 한 덩어리 미션"이라고 인지하게 함.

### 3.2 브리지 문구 — "방금 한 것"과 "다음 것" 연결

**현상**: [BridgeOverlay](app/components/subscriber/BridgeOverlay.tsx)는 *"색을 이용한 인지 활동입니다"*, *"리듬에 맞춰 움직이는 챌린지입니다"*, *"몰입 단계입니다. 잠시 후 시작해요."* 등 **다음 단계 설명만** 있음. 방금 끝난 단계에 대한 언급이 없어 끊긴 느낌.

**수정 포인트**:

- **bridge1 (Think → Play)**  
  - 현재: "리듬에 맞춰 움직이는 챌린지입니다. 잠시 후 시작해요."  
  - 보완 예: *"방금 집중력이 올라갔어요. 이제 그 에너지로 리듬을 맞춰볼까요? 잠시 후 챌린지가 시작해요."*  
  - (선택) 주차/테마가 있으면: *"이번 주 테마 챌린지, 리듬에 맞춰 움직여 보세요."*
- **bridge2 (Play → Flow)**  
  - 현재: "몰입 단계입니다. 잠시 후 시작해요."  
  - 보완 예: *"챌린지 잘했어요. 이제 마지막 단계, 우주를 달리며 몸을 풀어요. 잠시 후 시작해요."*
- **구현**: `BridgeOverlay`에 `prevPhase?: string` 또는 `prevPhaseLabel?: string` 추가해, "방금 ~했어요" 문장을 조합. 문구는 상수/설정으로 분리해 운영에서 수정 가능하게 두면 좋음.

**목표**: 브리지가 "대기 화면"이 아니라 **이전 단계 성취 + 다음 단계 기대**로 이어지게 함.

### 3.3 단계별 인트로·아웃트로 — 전체 여정 참조

**현상**:
- Think: [think150Scheduler](app/lib/admin/engines/think150/think150Scheduler.ts)의 intro(5초)는 *"색을 보고 발로 반응하며 두뇌를 깨워요"* / *"이름을 외치면서 점프하세요!"* 처럼 **Think만**의 설명.
- Flow: [coordContract PHRASES](app/flow-phase/engine/core/coordContract.ts)의 welcome은 *"우주의 세계에 온 것을 환영해요"* 로 **독립적인 세계관**만 있음.
- 전체 재생일 때 "지금이 3단계 중 몇 번째인지"가 드러나지 않음.

**수정 포인트**:

- **Think intro (전체 재생일 때만)**  
  - 첫 문장에 "오늘 10분의 첫 단계예요" 또는 "첫 번째 미션, 띵크예요"를 붙이거나, 주차 테마가 있으면 "이번 주 첫 단계" 등으로 **여정 상 위치**를 한 줄로 명시.
- **Flow welcome**  
  - 전체 재생 경로에서 진입했을 때: *"마지막 단계예요. 우주를 달리며 몸을 풀어 보세요."* 처럼 **세 번째 미션**임을 알리는 문구 추가(경로 플래그 또는 쿼리로 분기).
- **Think outro**  
  - [OUTRO_TEXTS](app/lib/admin/engines/think150/think150Scheduler.ts)는 교육적 마무리만 있음. 전체 재생일 때는 *"띵크 완료! 다음은 리듬 챌린지예요."* 같은 **다음 단계 예고** 한 줄을 선택적으로 붙일 수 있음(또는 브리지와 역할을 나누어 브리지에서만 다음 예고).

**목표**: 각 단계가 "혼자 있는 콘텐츠"가 아니라 **오늘 10분의 1/2/3막**으로 느껴지게 함.

### 3.4 완료 모달 — 미션 클리어 + (가능하면) 성장·다음 주

**현상**: [CompletionModal](app/components/subscriber/CompletionModal.tsx)은 *"수고했어요!"* / *"이번 주 웜업을 모두 완료했어요"* 로 **일회성 마무리**만 있음. "성과 지표"는 *"참여 횟수: —"*, *"누적 완주: —"* 로 비어 있고, *"실측 데이터 연동 후 자동 반영"*이라고만 되어 있음.

**수정 포인트**:

- **헤딩/설명을 "미션 클리어" 톤으로**  
  - 예: *"이번 주 미션 클리어!"* / *"띵크 → 챌린지 → 플로우, 10분 완주했어요."*  
  - 10분이 **한 덩어리 미션**이었다는 걸 다시 한 번 강조.
- **성과 지표**  
  - 데이터 연동 전이라도: *"완주: 이번 회차"*는 유지하고, *"참여 횟수"* / *"누적 완주"*가 없을 때는 *"다음에 완주할 때마다 여기에 쌓여요"* 처럼 **앞으로의 기대**를 한 줄로 안내.  
  - 연동 후에는 실제 수치로 "성장"이 보이게 하면 몰입·재방문 동기로 이어짐.
- **(선택) 다음 주 유도**  
  - 한 줄 예: *"다음 주에도 새로운 웜업이 준비돼 있어요."*  
  - 주차가 바뀌는 서비스이므로 "다음에 또 올 이유"를 콘텐츠로 제시.

**목표**: 10분이 **끝났다**는 것만이 아니라 **미션을 해냈다**는 만족감과, 가능하면 **다음 주에도 하고 싶다**는 느낌을 주는 것.

### 3.5 인단계 미세 피드백 (선택)

**현상**: 브리지나 단계 전환 시 "지금 2/3 단계 완료" 같은 **진행 감**이 없음. 레벨/구간은 각 phase 내부에만 있음.

**수정 포인트**:

- **브리지 상단 또는 카운트다운 위에**  
  - 예: *"1/3 완료"*, *"2/3 완료, 마지막 단계예요"*  
  - `FullSequencePlayer`에서 `phase`가 bridge1/bridge2일 때 `completedPhasesCount`를 넘겨 BridgeOverlay에 표시.
- **목표**: 10분 전체가 **한 개의 진행바**처럼 느껴지게 하는 보조 수단. UI 변경은 작고, 문구만으로도 효과 있음.

### 3.6 요약 — 콘텐츠 보완만으로 기대할 수 있는 것

| 영역 | 현재 | 보완 포인트 | 기대 효과 |
|------|------|-------------|-----------|
| 서사·목표감 | 없음 | 오프닝 "오늘의 미션: 띵크→챌린지→플로우" | 10분이 한 편으로 인지됨 |
| 브리지 | 다음 단계 설명만 | "방금 ~했어요" + "이제 ~해요" | 끊김 감소, 이어지는 느낌 |
| 단계 인트로/아웃토 | 각 phase만 설명 | "첫/마지막 단계", "다음은 챌린지" | 3막 구조로 인지 |
| 완료 모달 | 수고했어요 + 빈 지표 | 미션 클리어 톤 + 다음 기대/다음 주 유도 | 만족감·재방문 동기 |
| 진행 감 (선택) | 없음 | "1/3 완료" 등 | 전체 진행감 상승 |

UI/구조(iframe 제거, 브리지 15초 단축, 전체 진행바)와 함께 적용하면 **구조와 콘텐츠가 같이** 몰입을 끌어올린다.

---

## Part 4. 구현 시 참고

- 인증: Supabase Auth 세션(쿠키) 또는 JWT. 기존 앱에서 `supabase.auth.getUser()` 사용처 참고하여 동일 패턴 적용.
- 검증된 아이디: 우리쪽에서 제공할 저장소(테이블/API) 스키마가 정해지면, API에서 `user_id IN (allowlist)` 또는 동등한 검증만 추가하면 됨.
